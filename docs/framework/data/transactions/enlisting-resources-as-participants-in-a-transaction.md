---
title: "리소스를 트랜잭션에 참가 요소로 등록"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 786a12c2-d530-49f4-9c59-5c973e15a11d
caps.latest.revision: "3"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 98ac35edc458e370f2b7b9b116d2872d0db2da71
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 12/02/2017
---
# <a name="enlisting-resources-as-participants-in-a-transaction"></a><span data-ttu-id="00c8c-102">리소스를 트랜잭션에 참가 요소로 등록</span><span class="sxs-lookup"><span data-stu-id="00c8c-102">Enlisting Resources as Participants in a Transaction</span></span>
<span data-ttu-id="00c8c-103">트랜잭션에 참여하는 각 리소스는 RM(리소스 관리자)에 의해 관리되고, RM의 작업은 TM(트랜잭션 관리자)에 의해 조정됩니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-103">Each resource participating in a transaction is managed by a resource manager, whose actions are coordinated by a transaction manager.</span></span> <span data-ttu-id="00c8c-104">코디네이션은 트랜잭션 관리자를 통해 트랜잭션에 참여한 구독자에게 제공되는 알림을 통해 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-104">The coordination is done through notifications given to subscribers who have enlisted in a transaction through the transaction manager.</span></span>  
  
 <span data-ttu-id="00c8c-105">이 항목에서는 하나의 리소스(또는 여러 리소스)가 트랜잭션에 참여할 수 있는 방법과 여러 인리스트먼트 유형에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-105">This topic covers how a resource (or multiple resources) can be enlisted in a transaction, as well as the different types of enlistment.</span></span> <span data-ttu-id="00c8c-106">[단일 단계 및 다중 단계에서 트랜잭션 커밋](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) 항목에서는 트랜잭션 커밋 참여 한 리소스 간의 통합 수 있는 방법을 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-106">The [Committing a Transaction in Single-Phase and Multi-Phase](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) topic covers how transaction commitment can be coordinated among enlisted resources.</span></span>  
  
## <a name="enlisting-resources-in-a-transaction"></a><span data-ttu-id="00c8c-107">트랜잭션에 리소스 참여</span><span class="sxs-lookup"><span data-stu-id="00c8c-107">Enlisting Resources in a Transaction</span></span>  
 <span data-ttu-id="00c8c-108">리소스가 트랜잭션에 참가하려면 트랜잭션에 참여해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-108">In order for a resource to participate in a transaction, it must enlist in the transaction.</span></span> <span data-ttu-id="00c8c-109"><xref:System.Transactions.Transaction> 클래스 이름이로 시작 하는 메서드 집합을 정의 **Enlist** 이 기능을 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-109">The <xref:System.Transactions.Transaction> class defines a set of methods whose names begin with **Enlist** that provide this functionality.</span></span> <span data-ttu-id="00c8c-110">서로 다른 **Enlist** 다양 한 유형의 리소스 관리자를 가질 수 있는 인 리스트 먼 트에 해당 하는 방법입니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-110">The different **Enlist** methods correspond to the different types of enlistment that a resource manager may have.</span></span> <span data-ttu-id="00c8c-111">특히 일시적인 리소스에는 <xref:System.Transactions.Transaction.EnlistVolatile%2A> 메서드를 사용하고 지속적인 리소스에는 <xref:System.Transactions.Transaction.EnlistDurable%2A> 메서드를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-111">Specifically, you use the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods for volatile resources, and the <xref:System.Transactions.Transaction.EnlistDurable%2A> method for durable resources.</span></span> <span data-ttu-id="00c8c-112">리소스 관리자의 지속성(또는 일시성)은 리소스 관리자가 오류 복구를 지원하는지 여부를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-112">The durability (or conversely the volatility) of a resource manager refers to whether the resource manager supports failure recovery.</span></span> <span data-ttu-id="00c8c-113">오류 복구를 지원하는 경우 리소스 관리자는 Phase1(준비) 중에 지속적인 저장소에 데이터를 저장하여 리소스 관리자가 작동하지 않으면 복구 시 트랜잭션에 다시 참여하고 TM에서 받은 알림을 기반으로 적절한 작업을 수행할 수 있도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-113">If a resource manager supports failure recovery, it persists data to durable storage during Phase1 (prepare) such that if the resource manager goes down, it can re-enlist in the transaction upon recovery and perform the proper actions based on the notifications received from the TM.</span></span> <span data-ttu-id="00c8c-114">일반적으로 일시적인 리소스 관리자는 메모리 내 데이터 구조(예: 트랜잭션된 메모리 내 해시 테이블) 같은 일시적인 리소스를 관리하고 지속적인 리소스 관리자는 보다 지속적인 백업 저장소(예: 백업 저장소가 디스크인 데이터베이스)가 있는 리소스를 관리합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-114">In general, volatile resource managers manage volatile resources such as an in-memory data structure (for example, an in-memory transacted-hashtable), and durable resource managers manage resources that have a more persistent backing store (for example, a database whose backing store is disk).</span></span>  
  
 <span data-ttu-id="00c8c-115">단순성을 위해 리소스의 지속성 지원을 기반으로 <xref:System.Transactions.Transaction.EnlistDurable%2A> 또는 <xref:System.Transactions.Transaction.EnlistVolatile%2A> 메서드를 사용할지 결정한 후 리소스 관리자에 대한 <xref:System.Transactions.IEnlistmentNotification> 인터페이스를 구현하여 2PC(2단계 커밋)에 참가할 리소스를 참여시켜야 합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-115">For simplicity, after deciding whether to use the <xref:System.Transactions.Transaction.EnlistDurable%2A> or <xref:System.Transactions.Transaction.EnlistVolatile%2A> method based on your resource's durability support, you should enlist your resource to participate in Two Phase Commit (2PC) by implementing the <xref:System.Transactions.IEnlistmentNotification> interface for your resource manager.</span></span> <span data-ttu-id="00c8c-116">2PC에 대 한 자세한 내용은 참조 하십시오. [단일 단계 및 다중 단계에서 트랜잭션 커밋](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-116">For more information on 2PC, see [Committing a Transaction in Single-Phase and Multi-Phase](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md).</span></span>  
  
 <span data-ttu-id="00c8c-117">단일 참가자가 <xref:System.Transactions.Transaction.EnlistDurable%2A> 및 <xref:System.Transactions.Transaction.EnlistVolatile%2A>을 여러 번 호출하여 이러한 프로토콜에 두 개 이상 참여할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-117">A single participant can enlist for more than one of these protocols by calling <xref:System.Transactions.Transaction.EnlistDurable%2A> and <xref:System.Transactions.Transaction.EnlistVolatile%2A> multiple times.</span></span>  
  
### <a name="durable-enlistment"></a><span data-ttu-id="00c8c-118">지속적인 인리스트먼트</span><span class="sxs-lookup"><span data-stu-id="00c8c-118">Durable Enlistment</span></span>  
 <span data-ttu-id="00c8c-119"><xref:System.Transactions.Transaction.EnlistDurable%2A> 메서드는 지속적인 리소스로 트랜잭션에 참가할 리소스 관리자를 참여시키는 데 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-119">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods are used to enlist a resource manager for participation in the transaction as a durable resource.</span></span>  <span data-ttu-id="00c8c-120">지속적인 리소스 관리자가 트랜잭션 중에 중단될 경우 <xref:System.Transactions.TransactionManager.Reenlist%2A> 메서드를 사용하여 참가자로 활동했으며 2단계를 완료하지 않은 모든 트랜잭션에 다시 참여하여 온라인 상태가 되면 복구를 수행할 수 있으며, 복구 처리가 완료되면 <xref:System.Transactions.TransactionManager.RecoveryComplete%2A>를 호출할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-120">It is expected that if a durable resource manager is brought down in the middle of a transaction, it can perform recovery once it is brought back online by reenlisting (using the <xref:System.Transactions.TransactionManager.Reenlist%2A> method) in all transactions in which it was a participant and did not complete phase 2, and call <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> once it finishes recovery processing.</span></span> <span data-ttu-id="00c8c-121">복구에 대 한 자세한 내용은 참조 하십시오. [복구 수행](../../../../docs/framework/data/transactions/performing-recovery.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-121">For more information on recovery, see [Performing Recovery](../../../../docs/framework/data/transactions/performing-recovery.md).</span></span>  
  
 <span data-ttu-id="00c8c-122"><xref:System.Transactions.Transaction.EnlistDurable%2A> 메서드는 모두 <xref:System.Guid> 개체를 첫 번째 매개 변수로 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-122">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods all take a <xref:System.Guid> object as their first parameter.</span></span> <span data-ttu-id="00c8c-123"><xref:System.Guid>는 트랜잭션 관리자가 지속적인 인리스트먼트를 특정 리소스 관리자와 연결하는 데 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-123">The <xref:System.Guid> is used by the transaction manager to associate a durable enlistment with a particular resource manager.</span></span> <span data-ttu-id="00c8c-124">따라서 리소스 관리자는 일관되게 동일한 <xref:System.Guid>를 사용하여 다시 시작할 때 여러 리소스 관리자에서 자신을 식별해야 합니다. 그렇지 않으면 복구가 실패할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-124">As such, it is imperative that a resource manager consistently uses the same <xref:System.Guid> to identify itself even across different resource managers upon restarting, otherwise the recovery can fail.</span></span>  
  
 <span data-ttu-id="00c8c-125"><xref:System.Transactions.Transaction.EnlistDurable%2A> 메서드의 두 번째 매개 변수는 리소스 관리자가 트랜잭션 알림을 받기 위해 구현하는 개체에 대한 참조입니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-125">The second parameter of the <xref:System.Transactions.Transaction.EnlistDurable%2A> method is a reference to the object that the resource manager implements to receive transaction notifications.</span></span> <span data-ttu-id="00c8c-126">사용하는 오버로드는 리소스 관리자가 SPC(단일 단계 커밋) 최적화를 지원하는지 여부를 트랜잭션 관리자에게 알립니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-126">The overload you use informs the transaction manager whether your resource manager supports the Single Phase Commit (SPC) optimization.</span></span> <span data-ttu-id="00c8c-127">대체로 2PC(2단계 커밋)에 참여할 <xref:System.Transactions.IEnlistmentNotification> 인터페이스를 구현합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-127">Most of the time you would implement the <xref:System.Transactions.IEnlistmentNotification> interface to take part in Two-Phase Commit (2PC).</span></span> <span data-ttu-id="00c8c-128">그러나 커밋 프로세스를 최적화하려면 SPC에 대한 <xref:System.Transactions.ISinglePhaseNotification> 인터페이스 구현을 고려할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-128">However, if you want to optimize the commit process, you can consider implementing the <xref:System.Transactions.ISinglePhaseNotification> interface for SPC.</span></span> <span data-ttu-id="00c8c-129">SPC에 대 한 자세한 내용은 참조 하십시오. [단일 단계 및 다중 단계에서 트랜잭션 커밋](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) 및 [단일 단계 커밋 및 승격 가능한 단일 단계 알림을 사용 하 여 최적화](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-129">For more information on SPC, see [Committing a Transaction in Single-Phase and Multi-Phase](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) and [Optimization using Single Phase Commit and Promotable Single Phase Notification](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span></span>  
  
 <span data-ttu-id="00c8c-130">세 번째 매개 변수는 <xref:System.Transactions.EnlistmentOptions> 열거로, 해당 값은 <xref:System.Transactions.EnlistmentOptions.None> 또는 <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>일 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-130">The third parameter is an <xref:System.Transactions.EnlistmentOptions> enumeration, whose value can be either <xref:System.Transactions.EnlistmentOptions.None> or <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>.</span></span> <span data-ttu-id="00c8c-131">값이 <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>로 설정된 경우 인리스트먼트는 트랜잭션 관리자로부터 준비 알림을 받을 때 추가 리소스 관리자를 참여시킬 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-131">If the value is set to <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>, the enlistment may enlist additional resource managers upon receiving the Prepare notification from the transaction manager.</span></span> <span data-ttu-id="00c8c-132">그러나 이러한 유형의 인리스트먼트는 단일 단계 커밋 최적화에 사용할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-132">However, you should be aware that this type of enlistment is not eligible for the Single Phase Commit optimization.</span></span>  
  
### <a name="volatile-enlistment"></a><span data-ttu-id="00c8c-133">일시적인 인리스트먼트</span><span class="sxs-lookup"><span data-stu-id="00c8c-133">Volatile Enlistment</span></span>  
 <span data-ttu-id="00c8c-134">캐시 등의 일시적인 리소스를 관리하는 참가자는 <xref:System.Transactions.Transaction.EnlistVolatile%2A> 메서드를 사용하여 참여해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-134">Participants managing volatile resources such as a cache should enlist using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods.</span></span> <span data-ttu-id="00c8c-135">이러한 개체는 트랜잭션의 결과를 가져올 수 없거나 시스템 오류 후에 참여하는 트랜잭션의 상태를 복구할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-135">Such objects might not be able to obtain the outcome of a transaction or recover the state of any transaction they participate in after a system failure.</span></span>  
  
 <span data-ttu-id="00c8c-136">앞에서 설명한 것처럼 리소스 관리자는 일시적인 메모리 내 리소스를 관리하는 경우에 일시적인 인리스트먼트를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-136">As stated previously, a resource manager would make a volatile enlistment if it manages an in-memory, volatile resource.</span></span> <span data-ttu-id="00c8c-137"><xref:System.Transactions.Transaction.EnlistVolatile%2A>을 사용하면 트랜잭션의 불필요한 에스컬레이션을 강제하지 않는다는 장점이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-137">One of the benefits of using <xref:System.Transactions.Transaction.EnlistVolatile%2A> is that it does not force an unnecessary escalation of the transaction.</span></span> <span data-ttu-id="00c8c-138">트랜잭션 에스컬레이션에 대 한 자세한 내용은 참조 하십시오. [트랜잭션 관리 에스컬레이션](../../../../docs/framework/data/transactions/transaction-management-escalation.md) 항목입니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-138">For more information on transaction escalation, see [Transaction Management Escalation](../../../../docs/framework/data/transactions/transaction-management-escalation.md) topic.</span></span> <span data-ttu-id="00c8c-139">일시적인 인리스트먼트는 트랜잭션 관리자의 인리스트먼트 처리 방법과 트랜잭션 관리자가 예상하는 리소스 관리자의 작업에서 모두 차이가 있음을 의미합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-139">Enlisting volatilely implies both a difference in how the enlistment is handled by the transaction manager, as well as what is expected of the resource manager by the transaction manager.</span></span> <span data-ttu-id="00c8c-140">이는 일시적인 리소스 관리자가 복구를 수행하지 않기 때문입니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-140">This is because a volatile resource manager does not perform recovery.</span></span> <span data-ttu-id="00c8c-141"><xref:System.Transactions.Transaction.EnlistVolatile%2A> 메서드는 <xref:System.Guid> 매개 변수를 사용하지 않습니다. 이는 일시적인 리소스 관리자가 복구를 수행하지 않으며 <xref:System.Transactions.TransactionManager.Reenlist%2A>가 필요한 <xref:System.Guid> 메서드를 호출하지 않기 때문입니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-141">The <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods do not take a <xref:System.Guid> parameter, because a volatile resource manager does not perform recovery and would not call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method which needs a <xref:System.Guid>.</span></span>  
  
 <span data-ttu-id="00c8c-142">지속적인 인리스트먼트와 마찬가지로 인리스트먼트에 사용하는 오버로드 메서드는 리소스 관리자가 단일 단계 커밋 최적화를 지원하는지 여부를 트랜잭션 관리자에게 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-142">As with durable enlistments, whichever overload method you use to enlist denotes to the transaction manager whether your resource manager supports the Single Phase Commit optimization.</span></span> <span data-ttu-id="00c8c-143">일시적인 리소스 관리자는 복구를 수행할 수 없으므로 준비 단계 중에 일시적인 인리스트먼트에 대한 복구 정보는 작성되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-143">Since a volatile resource manager cannot perform recovery, no recovery information is written for a volatile enlistment during the Prepare phase.</span></span> <span data-ttu-id="00c8c-144">따라서 <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> 메서드를 호출하면 <xref:System.InvalidOperationException>이 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-144">Therefore, calling the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> method results in an <xref:System.InvalidOperationException>.</span></span>  
  
 <span data-ttu-id="00c8c-145">다음 예제에서는 <xref:System.Transactions.Transaction.EnlistVolatile%2A> 메서드를 사용하여 트랜잭션의 참가자로 이러한 개체를 참여시키는 방법을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-145">The following example shows how to enlist such an object as a participant in a transaction using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> method.</span></span>  
  
 [!code-csharp[Tx_Enlist#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/tx_enlist/cs/enlist.cs#1)]
 [!code-vb[Tx_Enlist#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/tx_enlist/vb/enlist.vb#1)]  
  
### <a name="optimizing-performance"></a><span data-ttu-id="00c8c-146">성능 최적화</span><span class="sxs-lookup"><span data-stu-id="00c8c-146">Optimizing Performance</span></span>  
 <span data-ttu-id="00c8c-147"><xref:System.Transactions.Transaction> 클래스는 PSPE(승격 가능한 단일 단계 인리스트먼트)를 참여시키는 <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> 메서드도 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-147">The <xref:System.Transactions.Transaction> class also provides the <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> method to enlist a Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="00c8c-148">이 메서드를 사용하면 지속적인 RM(리소스 관리자)이 트랜잭션을 호스팅하고 "소유"할 수 있으며, 필요한 경우 MSDTC에서 관리하도록 나중에 해당 트랜잭션을 에스컬레이션할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-148">This allows a durable resource manager (RM) to host and "own" a transaction that can later be escalated to be managed by the MSDTC if necessary.</span></span> <span data-ttu-id="00c8c-149">이 대 한 자세한 내용은 참조 하십시오. [단일 단계 커밋 및 승격 가능한 단일 단계 알림을 사용 하 여 최적화](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="00c8c-149">For more information on this, see [Optimization using Single Phase Commit and Promotable Single Phase Notification](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="00c8c-150">참고 항목</span><span class="sxs-lookup"><span data-stu-id="00c8c-150">See Also</span></span>  
 [<span data-ttu-id="00c8c-151">단일 단계 커밋 및 승격 가능한 단일 단계 알림을 사용 하 여 최적화</span><span class="sxs-lookup"><span data-stu-id="00c8c-151">Optimization using Single Phase Commit and Promotable Single Phase Notification</span></span>](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md)  
 [<span data-ttu-id="00c8c-152">1 단계 및 다중 단계에서 트랜잭션 커밋</span><span class="sxs-lookup"><span data-stu-id="00c8c-152">Committing a Transaction in Single-Phase and Multi-Phase</span></span>](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md)
