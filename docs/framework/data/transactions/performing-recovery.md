---
title: "복구 수행"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 6dd17bf6-ba42-460a-a44b-8046f52b10d0
caps.latest.revision: "3"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: a73e1b5c6cbb18e89b30550f02c0678e76d12ab4
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 10/18/2017
---
# <a name="performing-recovery"></a><span data-ttu-id="0a210-102">복구 수행</span><span class="sxs-lookup"><span data-stu-id="0a210-102">Performing Recovery</span></span>
<span data-ttu-id="0a210-103">리소스 관리자는 리소스 오류가 발생한 후에 트랜잭션 참가 요소를 다시 참여시켜 트랜잭션에서 영속적 참여 항목을 쉽게 확인할 수 있도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-103">A resource manager facilitates resolution of durable enlistments in a transaction by reenlisting the transaction participant after resource failure.</span></span>  
  
## <a name="the-recovery-process"></a><span data-ttu-id="0a210-104">복구 프로세스</span><span class="sxs-lookup"><span data-stu-id="0a210-104">The Recovery Process</span></span>  
 <span data-ttu-id="0a210-105"><xref:System.Transactions.IEnlistmentNotification> 인터페이스 구현에서 설명한 대로 나중에 복구할 수 있는 리소스를 지속적으로 참여시키려면 <xref:System.Transactions.Transaction.EnlistDurable%2A> 메서드를 호출해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-105">To durably enlist a resource (described by an implementation of the <xref:System.Transactions.IEnlistmentNotification> interface) that can later be eligible for recovery, you should call the <xref:System.Transactions.Transaction.EnlistDurable%2A> method.</span></span> <span data-ttu-id="0a210-106">또한 리소스 오류가 발생할 경우 트랜잭션 참가자에 일관성 있게 레이블을 지정하는 데 사용되는 리소스 관리자 식별자(<xref:System.Transactions.Transaction.EnlistDurable%2A>)를 <xref:System.Guid> 메서드에 제공해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-106">In addition, you must provide the <xref:System.Transactions.Transaction.EnlistDurable%2A> method with a resource manager identifier (a <xref:System.Guid>) that is used to consistently label the participant of the transaction in the event of a resource failure.</span></span> <span data-ttu-id="0a210-107">이러한 이유로 <xref:System.Guid> 초기 Enlist에 호출 동일 해야 하는 제공 되는 *resourceManagerIdentifier* 에서 매개 변수는 <xref:System.Transactions.TransactionManager.Reenlist%2A> 복구 하는 동안 호출 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-107">For this reason, the <xref:System.Guid> that is provided to the initial Enlist call should be identical to the *resourceManagerIdentifier* parameter in the <xref:System.Transactions.TransactionManager.Reenlist%2A> call during recovery.</span></span> <span data-ttu-id="0a210-108">그렇지 않으면 <xref:System.Transactions.TransactionException>이 throw됩니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-108">Otherwise, <xref:System.Transactions.TransactionException> is thrown.</span></span> <span data-ttu-id="0a210-109">지속적인 인리스트먼트에 대 한 자세한 내용은 참조 하십시오. [트랜잭션에서 참가자 인 리스트 먼 트 리소스](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-109">For more information on durable enlistments, see [Enlisting Resources as Participants in a Transaction](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) .</span></span>  
  
 <span data-ttu-id="0a210-110">2PC 프로토콜의 준비 단계(1단계)에서 지속적인 리소스 관리자의 구현이 <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> 알림을 받는 경우 이 단계 중에 준비 레코드를 기록해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-110">In the prepare phase (phase 1) of the 2PC protocol, when your implementation of a durable resource manager receives the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification, it should log its prepare record during this phase.</span></span> <span data-ttu-id="0a210-111">이 레코드에는 커밋 시 트랜잭션을 완료하는 데 필요한 모든 정보가 들어 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-111">The record should contain all the information that is necessary to complete the transaction on commit.</span></span> <span data-ttu-id="0a210-112">준비 레코드 나중에 복구 하는 동안 검색 하 여 액세스할 수는 <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> 의 속성은 *preparingEnlistment* 콜백 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-112">The prepare record can later be accessed during recovery by retrieving the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the *preparingEnlistment* callback.</span></span> <span data-ttu-id="0a210-113"><xref:System.Transactions.IEnlistmentNotification.Prepare%2A> 메서드 내에서 레코드 로깅을 수행하지 않아도 됩니다. RM이 작업자 스레드에서 이 작업을 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-113">The record logging does not need to be performed within the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> method as the RM can do this on a worker thread.</span></span>  
  
 <span data-ttu-id="0a210-114">복구 프로세스는 다음 두 단계로 이루어집니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-114">The recovery process consists of the following two steps:</span></span>  
  
### <a name="step-1---reenlist"></a><span data-ttu-id="0a210-115">1단계 - ReEnlist</span><span class="sxs-lookup"><span data-stu-id="0a210-115">Step 1 - ReEnlist</span></span>  
 <span data-ttu-id="0a210-116">리소스 관리자는 준비 정보 레코드에서 불확실한 각 인리스트먼트를 검사합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-116">The resource manager examines the prepare information record for each enlistment that is in-doubt.</span></span> <span data-ttu-id="0a210-117">1단계 중에 <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> 알림에 포함되어 리소스 관리자에게 전달되는 <xref:System.Transactions.PreparingEnlistment> 콜백의 <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> 속성을 검사하면 됩니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-117">This is done by examining the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the <xref:System.Transactions.PreparingEnlistment> callback, which is passed to the resource manager in the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification during phase 1.</span></span>  
  
 <span data-ttu-id="0a210-118">리소스 관리자는 검사하는 각 인리스트먼트에 대해 트랜잭션 관리자에서 <xref:System.Transactions.TransactionManager.Reenlist%2A>를 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-118">For each such enlistment it examines, it invokes <xref:System.Transactions.TransactionManager.Reenlist%2A> on the transaction manager.</span></span> <span data-ttu-id="0a210-119">이 메서드는 리소스 관리자를 식별하는 고유한 <xref:System.Guid>와 바이트 배열로 인터페이스 정보를 전달합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-119">This method passes on a unique <xref:System.Guid> that identifies the resource manager, as well as the enlistment's information in a byte array.</span></span> <span data-ttu-id="0a210-120">새 <xref:System.Transactions.Enlistment> 개체가 반환됩니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-120">A new <xref:System.Transactions.Enlistment> object is returned.</span></span> <span data-ttu-id="0a210-121">예외가 발생하여 인리스트먼트 재시도가 실패하면 리소스 관리자가 나중에 다시 시도해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-121">If the reenlistment fails with an exception, the resource manager will need to retry at a later time.</span></span>  
  
 <span data-ttu-id="0a210-122">오류 발생 후 리소스 관리자가 다시 시작될 때만 <xref:System.Transactions.TransactionManager.Reenlist%2A> 메서드를 호출해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-122">You should only call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method when a resource manager restarts from failure.</span></span> <span data-ttu-id="0a210-123">또한 2단계 커밋의 초기 준비 단계에서 리소스 관리자가 로그한 미해결된 트랜잭션만 다시 참여시켜야 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-123">In addition, you should only reenlist unresolved transactions logged by a resource manager during the initial Prepare phase of a two-phase commit.</span></span> <span data-ttu-id="0a210-124">알맞지 않은 시기에 이 메서드를 호출하려고 하면 잘못된 결과가 생성될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-124">Any attempt to call this method at invalid times can produce erroneous results.</span></span>  
  
 <span data-ttu-id="0a210-125">이 메서드를 사용하여 참가 요소가 다시 참여되면 트랜잭션 결과에 해당하는 <xref:System.Transactions.IEnlistmentNotification>의 2단계 메서드(즉, <xref:System.Transactions.IEnlistmentNotification.Commit%2A> , <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> 또는 <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A>)가 알맞게 호출됩니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-125">When a participant is reenlisted using this method, the phase 2 methods of <xref:System.Transactions.IEnlistmentNotification> that correspond to the transaction's outcome (that is, <xref:System.Transactions.IEnlistmentNotification.Commit%2A> , <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> or <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A> ) are called as appropriate.</span></span>  
  
### <a name="step-2---completing-the-recovery"></a><span data-ttu-id="0a210-126">2단계 - 복구 완료</span><span class="sxs-lookup"><span data-stu-id="0a210-126">Step 2 - Completing the recovery</span></span>  
 <span data-ttu-id="0a210-127">인리스트먼트 재시도가 모두 완료되면 리소스 관리자가 <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> 메서드를 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-127">When all the reenlistments are finished, the resource manager calls the <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> method.</span></span> <span data-ttu-id="0a210-128">이 메서드는 복구를 완료하고 리소스 관리자에 더 이상 불확실한 트랜잭션이 없음을 트랜잭션 관리자에게 알립니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-128">This method completes the recovery and informs the transaction manager that the resource manager has no more in-doubt transactions.</span></span> <span data-ttu-id="0a210-129">이렇게 함으로써 리소스 관리자는 <xref:System.Transactions.TransactionManager.Reenlist%2A> 메서드를 다시 호출하지 않도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-129">By doing so, the resource manager guarantees that it will not invoke the <xref:System.Transactions.TransactionManager.Reenlist%2A> method again.</span></span>  
  
 <span data-ttu-id="0a210-130">리소스 관리자가 새 트랜잭션에 참여하기 전에 불확실한 트랜잭션을 모두 해결할 필요는 없습니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-130">A resource manager is not required to resolve all in-doubt transactions before enlisting in new transactions.</span></span> <span data-ttu-id="0a210-131">첫 번째 단계는 트랜잭션 관리자 뒤와 관계를 설정 하는 리소스 관리자 후 언제 든 지 수행할 수 있습니다 <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> 되었습니다 (2 단계)를 호출; 1 단계를 다시 수행할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-131">The first step can be performed at any time after the resource manager establishes a relationship with the transaction manager, but after <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> has been invoked (step 2); step 1 cannot be performed again.</span></span> <span data-ttu-id="0a210-132">2단계는 트랜잭션의 결과에 영향을 주지 않고 여러 번 반복할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="0a210-132">Step 2 can be repeated multiple times without affecting the outcome of transactions.</span></span>
