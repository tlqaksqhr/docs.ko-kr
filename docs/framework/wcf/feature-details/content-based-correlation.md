---
title: 내용 기반 상관 관계
ms.date: 03/30/2017
ms.assetid: f46a2b68-8d24-4122-bbee-9573fc3f9fb4
ms.openlocfilehash: 48009420788b8678f842c4368926e04f8a745a52
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 05/04/2018
ms.locfileid: "33494217"
---
# <a name="content-based-correlation"></a><span data-ttu-id="6e990-102">내용 기반 상관 관계</span><span class="sxs-lookup"><span data-stu-id="6e990-102">Content Based Correlation</span></span>
<span data-ttu-id="6e990-103">워크플로 서비스가 클라이언트 및 기타 서비스와 통신할 때 교환되는 메시지에는 해당 메시지를 특정 인스턴스와 고유하게 연결하는 데 사용할 수 있는 데이터가 있을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-103">When workflow services communicate with clients and other services, often there is some data in the exchanged messages that uniquely relates a message to a particular instance.</span></span> <span data-ttu-id="6e990-104">내용 기반 상관 관계는 메시지에 있는 이 데이터(예: 고객 번호 또는 주문 ID)를 사용하여 메시지를 적절한 워크플로 인스턴스에 라우트합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-104">Content-based correlation uses this data in the message, such as a customer number or order ID, to route messages to the proper workflow instance.</span></span> <span data-ttu-id="6e990-105">이 항목에서는 워크플로에서 내용 기반 상관 관계를 사용하는 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-105">This topic explains how to use content-based correlation in workflows.</span></span>  
  
## <a name="using-content-based-correlation"></a><span data-ttu-id="6e990-106">내용 기반 상관 관계 사용</span><span class="sxs-lookup"><span data-stu-id="6e990-106">Using Content-Based Correlation</span></span>  
 <span data-ttu-id="6e990-107">내용 기반 상관 관계는 워크플로 서비스에 단일 클라이언트가 액세스하는 메서드가 여러 개 있고 교환되는 메시지의 일부 데이터로 원하는 인스턴스를 식별할 수 있는 경우에 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-107">Content-based correlation is used when a workflow service has multiple methods that are accessed by a single client and a piece of data in the exchanged messages identifies the desired instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6e990-108">내용 기반 상관 관계는 지원되는 컨텍스트 교환 바인딩이 없어 컨텍스트 상관 관계를 사용할 수 없는 경우에 유용합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-108">Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings.</span></span> <span data-ttu-id="6e990-109">컨텍스트 상관 관계에 대 한 자세한 내용은 참조 [컨텍스트 교환](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-109">For more information about context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span></span>  
  
 <span data-ttu-id="6e990-110">이러한 통신에 사용되는 각 메시징 작업은 메시지에서 인스턴스를 고유하게 식별하는 데이터가 있는 위치를 지정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-110">Each messaging activity used in these communications must specify the location of the data in the message that uniquely identifies the instance.</span></span> <span data-ttu-id="6e990-111">이 작업은 <xref:System.ServiceModel.MessageQuerySet> 또는 <xref:System.ServiceModel.Activities.QueryCorrelationInitializer>을 통해 메시지에서 인스턴스를 고유하게 식별하는 데이터를 쿼리하는 <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>을 제공하여 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-111">This is done by providing a <xref:System.ServiceModel.MessageQuerySet>, using either a <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> or <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, that queries the message for the piece or pieces of data that uniquely identify the instance.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="6e990-112">인스턴스를 식별하는 데 사용되는 데이터는 상관 관계 키로 해시됩니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-112">The data that is used to identify the instance is hashed into a correlation key.</span></span> <span data-ttu-id="6e990-113">상관 관계에는 고유한 데이터를 사용해야 합니다. 그렇지 않으면 해시된 키에서 충돌이 발생하여 메시지가 잘못 라우트될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-113">Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted.</span></span> <span data-ttu-id="6e990-114">예를 들어 고객 이름에만 의존하는 상관 관계는 동일한 이름을 가진 고객이 여러 명 있을 수 있으므로 충돌을 일으킬 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-114">For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name.</span></span> <span data-ttu-id="6e990-115">메시지를 상호 연결하는 데 사용되는 데이터에 콜론(`:`)을 포함하면 안 됩니다. 이는 이후에 해시되는 문자열을 만들기 위해 메시지 쿼리의 키와 값을 구분하는 데 콜론이 이미 사용되기 때문입니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-115">The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message query’s key and value to form the string that is subsequently hashed.</span></span>  
  
 <span data-ttu-id="6e990-116">다음 예에서 초기 <xref:System.ServiceModel.Activities.Receive> / <xref:System.ServiceModel.Activities.SendReply> 반환을 워크플로 서비스에는 `OrderId`, 다음 예제에서 클라이언트에서 다시 전달 되는 <xref:System.ServiceModel.Activities.Receive> 워크플로 서비스의 활동입니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-116">In the following example, the initial <xref:System.ServiceModel.Activities.Receive>/<xref:System.ServiceModel.Activities.SendReply> in a workflow service returns an `OrderId`, which is then passed back by the client on the call to the following <xref:System.ServiceModel.Activities.Receive> activity in the workflow service.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#1)]  
  
 <span data-ttu-id="6e990-117">이전 예제에서는 <xref:System.ServiceModel.Activities.SendReply>에 의해 초기화되는 내용 기반 상관 관계를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-117">The previous example shows a content-based correlation that is initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="6e990-118"><xref:System.ServiceModel.MessageQuerySet>은 이 서비스에 대한 후속 메시지를 식별하는 데 사용되는 데이터가 `OrderId`가 되도록 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-118">The <xref:System.ServiceModel.MessageQuerySet> specifies that the data used to identify subsequent messages to this service is the `OrderId`.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="6e990-119">워크플로에서 <xref:System.ServiceModel.Activities.Receive>를 따르는 <xref:System.ServiceModel.Activities.SendReply> 작업은 <xref:System.ServiceModel.Activities.SendReply>에 의해 초기화되는 상관 관계를 따릅니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-119">The <xref:System.ServiceModel.Activities.Receive> activity that follows the <xref:System.ServiceModel.Activities.SendReply> in the workflow follows the correlation that was initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="6e990-120">두 작업은 동일한 <xref:System.ServiceModel.Activities.CorrelationHandle>을 공유하지만 특정 메시지에서 식별 데이터가 있는 위치를 지정하는 <xref:System.ServiceModel.MessageQuerySet> 및 <xref:System.ServiceModel.XPathMessageQuery>는 공유하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-120">Both activities share the same <xref:System.ServiceModel.Activities.CorrelationHandle>, but each one has its own <xref:System.ServiceModel.MessageQuerySet> and <xref:System.ServiceModel.XPathMessageQuery> that specifies where the identifying data is in that particular message.</span></span> <span data-ttu-id="6e990-121"><xref:System.ServiceModel.MessageQuerySet>은 상관 관계를 초기화하는 작업의 경우 <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> 속성에 지정되고 다음 <xref:System.ServiceModel.Activities.Receive> 작업의 경우 <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> 속성을 사용하여 지정됩니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-121">On the activity that initializes the correlation, this <xref:System.ServiceModel.MessageQuerySet> is specified in the <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> property, and for any following <xref:System.ServiceModel.Activities.Receive> activities, it is specified using the <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> property.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="6e990-122">내용 기반 상관 관계는 데이터가 메시지의 일부로 전달될 때 메시징 작업(<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>)에 의해 초기화될 수 있으며,</span><span class="sxs-lookup"><span data-stu-id="6e990-122">A content-based correlation can be initialized by any messaging activity (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) when the data flows as part of a message.</span></span> <span data-ttu-id="6e990-123">데이터의 특정 부분이 메시지의 일부로 전달되지 않을 경우 <xref:System.ServiceModel.Activities.InitializeCorrelation> 작업을 사용하여 명시적으로 초기화될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-123">If the particular piece of data does not flow as part of a message, then it can be initialized explicitly by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="6e990-124">메시지를 고유하게 식별하기 위해 데이터의 여러 부분이 필요할 경우 <xref:System.ServiceModel.MessageQuerySet>에 여러 개의 쿼리를 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-124">If multiple pieces of data are required to uniquely identify the message, then multiple queries can be added to the <xref:System.ServiceModel.MessageQuerySet>.</span></span> <span data-ttu-id="6e990-125">이러한 예제에서는 <xref:System.ServiceModel.Activities.CorrelationHandle> 또는 `CorrelatesWith` 속성을 사용하여 각 작업에 `CorrelationHandle`이 명시적으로 제공되었지만 모든 데이터가 `OrderId`와 상호 연결되는 이 예제처럼 전체 워크플로에 하나의 상관 관계만 필요한 경우 <xref:System.ServiceModel.Activities.WorkflowServiceHost>가 제공하는 암시적 상관 관계 핸들 관리만으로 충분합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-125">In these examples, a <xref:System.ServiceModel.Activities.CorrelationHandle> was explicitly provided to each of the activities using the `CorrelatesWith` or `CorrelationHandle` properties, but if there is only one correlation required for the entire workflow, such as in this example where everything correlates on `OrderId`, the implicit correlation handle management provided by <xref:System.ServiceModel.Activities.WorkflowServiceHost> is sufficient.</span></span>  
  
## <a name="using-the-initializecorrelation-activity"></a><span data-ttu-id="6e990-126">InitializeCorrelation 작업 사용</span><span class="sxs-lookup"><span data-stu-id="6e990-126">Using the InitializeCorrelation Activity</span></span>  
 <span data-ttu-id="6e990-127">이전 예제에서는 `OrderId`가 <xref:System.ServiceModel.Activities.SendReply> 작업을 통해 호출자에게 전달되었고, 이때 상관 관계가 초기화되었습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-127">In the previous example, the `OrderId` flowed to the caller through the <xref:System.ServiceModel.Activities.SendReply> activity and this is where the correlation was initialized.</span></span> <span data-ttu-id="6e990-128">이 동작은 <xref:System.ServiceModel.Activities.InitializeCorrelation> 작업을 사용하여 수행할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-128">The same behavior can be accomplished by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="6e990-129"><xref:System.ServiceModel.Activities.InitializeCorrelation> 작업은 메시지를 올바른 인스턴스에 매핑하는 데 사용되는 데이터를 나타내는 항목의 사전과 <xref:System.ServiceModel.Activities.CorrelationHandle>을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-129">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity takes the <xref:System.ServiceModel.Activities.CorrelationHandle> and a dictionary of items that represent the data used to map the message to the correct instance.</span></span> <span data-ttu-id="6e990-130">위의 샘플에서 <xref:System.ServiceModel.Activities.InitializeCorrelation> 작업을 사용하려면 <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> 작업에서 <xref:System.ServiceModel.Activities.SendReply>를 제거하고 <xref:System.ServiceModel.Activities.InitializeCorrelation> 작업을 사용하여 상관 관계를 초기화합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-130">To use the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity in the preceding sample, remove the <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> from the <xref:System.ServiceModel.Activities.SendReply> activity and initialize the correlation using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#4)]  
  
 <span data-ttu-id="6e990-131">그러면 데이터를 보유하는 변수가 채워진 후, 초기화된 <xref:System.ServiceModel.Activities.InitializeCorrelation>과 상호 연결되는 <xref:System.ServiceModel.Activities.Receive> 작업이 시작되기 전에 <xref:System.ServiceModel.Activities.CorrelationHandle> 작업이 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-131">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity is then used in the workflow, after the variables that hold the data are populated but before the <xref:System.ServiceModel.Activities.Receive> activity that correlates with the initialized <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#5)]  
  
## <a name="configuring-xpath-queries-using-the-workflow-designer"></a><span data-ttu-id="6e990-132">Workflow Designer를 사용하여 XPath 쿼리 구성</span><span class="sxs-lookup"><span data-stu-id="6e990-132">Configuring XPath Queries Using the Workflow Designer</span></span>  
 <span data-ttu-id="6e990-133">이전 예제에서는 메시지 쿼리에 사용되는 작업 및 XPath 쿼리가 코드에서 지정되었습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-133">In the previous examples, the activities and the XPath queries used in the message queries were specified in code.</span></span> <span data-ttu-id="6e990-134">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]의 Workflow Designer는 내용 기반 상관 관계의 `DataContract` 형식을 사용하여 XPath를 생성할 수 있는 기능도 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-134">The workflow designer in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] also provides the ability to generate XPaths from `DataContract` types for content-based correlation.</span></span> <span data-ttu-id="6e990-135">이전 예제에 구성된 첫 번째 XPath는 <xref:System.ServiceModel.Activities.SendReply>에 대해 구성되었습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-135">The first XPath configured in the previous example was configured for the <xref:System.ServiceModel.Activities.SendReply>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="6e990-136">워크플로 디자이너에서 메시징 작업의 XPath를 구성하려면 워크플로 디자이너에서 작업을 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-136">To configure the XPath for a messaging activity in the workflow designer, select the activity in the workflow designer.</span></span> <span data-ttu-id="6e990-137">활동 앞의 예와 상관 관계를 초기화 하는 경우에 대 한 줄임표 단추를 클릭는 **CorrelationInitializers** 속성에는 **속성** 창.</span><span class="sxs-lookup"><span data-stu-id="6e990-137">If the activity is initializing the correlation, as in the previous example, click the ellipsis button for the **CorrelationInitializers** property in the **Properties** window.</span></span> <span data-ttu-id="6e990-138">그러면 표시 됩니다는 **상관 관계 이니셜라이저 추가** 대화 상자 창.</span><span class="sxs-lookup"><span data-stu-id="6e990-138">This displays the **Add Correlation Initializers** dialog window.</span></span> <span data-ttu-id="6e990-139">이 대화 상자에서 상관 관계 형식을 지정하고 상관 관계에 사용할 내용을 선택할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-139">From this dialog you can specify the correlation type and select the content that is used for the correlation.</span></span> <span data-ttu-id="6e990-140"><xref:System.ServiceModel.Activities.CorrelationHandle> 에 지정 된 변수는 **이니셜라이저 추가** 에서 선택 상자에서 상관 관계 유형 및 상관 관계에 사용 되는 데이터는 **XPath 쿼리** 대화 상자의 섹션.</span><span class="sxs-lookup"><span data-stu-id="6e990-140">The <xref:System.ServiceModel.Activities.CorrelationHandle> variable is specified in the **Add initializer** box, and the correlation type and data used for the correlation is selected from the **XPath Queries** section of the dialog box.</span></span>  
  
 <span data-ttu-id="6e990-141">![CorrelationInitializer 대화 상자](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span><span class="sxs-lookup"><span data-stu-id="6e990-141">![CorrelationInitializer Dialog](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span></span>  
  
 <span data-ttu-id="6e990-142">이전 예제에 있는 두 번째 XPath 쿼리는 <xref:System.ServiceModel.Activities.Receive> 작업에서 구성되었습니다.</span><span class="sxs-lookup"><span data-stu-id="6e990-142">The second XPath query in the previous example was configured in the <xref:System.ServiceModel.Activities.Receive> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="6e990-143">상관 관계를 초기화 하지 않는 메시징 작업에 대 한 XPath 쿼리를 구성 하려면 워크플로 디자이너에서 활동을 선택 하 고 다음에 대 한 줄임표 단추를 클릭는 **CorrelatesOn** 속성에는  **속성** 창.</span><span class="sxs-lookup"><span data-stu-id="6e990-143">To configure the XPath query for a messaging activity that does not initialize the correlation, select the activity in the workflow designer and then click the ellipsis button for the **CorrelatesOn** property in the **Properties** window.</span></span> <span data-ttu-id="6e990-144">그러면 표시 됩니다는 **CorrelatesOn 정의** 대화 상자 창.</span><span class="sxs-lookup"><span data-stu-id="6e990-144">This displays the **CorrelatesOn Definition** dialog window.</span></span>  
  
 <span data-ttu-id="6e990-145">![CorrelatesOn 정의](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span><span class="sxs-lookup"><span data-stu-id="6e990-145">![CorrelatesOn Definition](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span></span>  
  
 <span data-ttu-id="6e990-146">이 대화 상자에서 지정 된 <xref:System.ServiceModel.Activities.CorrelationHandle> 에서 항목을 선택 하 고는 **XPath 쿼리** XPath 쿼리를 작성 하는 목록.</span><span class="sxs-lookup"><span data-stu-id="6e990-146">From this dialog you specify the <xref:System.ServiceModel.Activities.CorrelationHandle> and choose items in the **XPath Queries** list to build the XPath query.</span></span>
