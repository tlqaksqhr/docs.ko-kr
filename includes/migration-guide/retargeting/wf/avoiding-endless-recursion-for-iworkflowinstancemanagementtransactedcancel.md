### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="8d5df-101">IWorkflowInstanceManagement.TransactedCancel 및 IWorkflowInstanceManagement.TransactedTerminate의 무한 재귀를 방지</span><span class="sxs-lookup"><span data-stu-id="8d5df-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

|   |   |
|---|---|
|<span data-ttu-id="8d5df-102">설명</span><span class="sxs-lookup"><span data-stu-id="8d5df-102">Details</span></span>|<span data-ttu-id="8d5df-103"><xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> 또는 <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> API를 사용하여 워크플로 인스턴스를 취소하거나 종료하는 경우에 워크플로 인스턴스는 <code>Workflow</code> 런타임이 요청 처리의 일부로 서비스 인스턴스를 유지하려 할 때 무한 재귀로 인해 스택 오버플로가 발생할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a worklow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the <code>Workflow</code> runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="8d5df-104">워크플로 인스턴스가 일부 기타 처리 중인 WCF가 다른 서비스가 완료되기를 대기 중인 상태에 있는 경우 문제가 발생합니다. <code>TransactedCancel</code> 및 <code>TransactedTerminate</code> 작업은 워크플로 서비스 인스턴스에 대해 큐 대기 중인 작업 항목을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.The <code>TransactedCancel</code> and <code>TransactedTerminate</code> operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="8d5df-105">이러한 작업 항목은 <code>TransactedCancel/TransactedTerminate</code> 요청 처리의 일부로 실행되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-105">These work items are not executed as part of the processing of the <code>TransactedCancel/TransactedTerminate</code> request.</span></span> <span data-ttu-id="8d5df-106">워크플로 서비스 인스턴스는 기타 처리 중인 WCF 요청이 완료되기를 기다리느라 사용 중이므로 만든 작업 항목은 큐 대기 상태를 유지합니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-106">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="8d5df-107"><code>TransactedCancel/TransactedTerminate</code> 작업이 완료되고 컨트롤이 다시 클라이언트로 반환됩니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-107">The <code>TransactedCancel/TransactedTerminate</code> operation completes and control is returned back to the client.</span></span> <span data-ttu-id="8d5df-108"><code>TransactedCancel/TransactedTerminate</code> 작업과 연관된 트랜잭션이 커밋하려 하는 경우 워크플로 서비스 인스턴스 상태를 유지해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-108">When the transaction associated with the <code>TransactedCancel/TransactedTerminate</code> operation attempts to commit, it needs to persist the workflow serivce instance state.</span></span> <span data-ttu-id="8d5df-109">그러나 인스턴스에 대해 처리 중인 <code>WCF</code> 요청이 있기 때문에 워크플로 런타임은 워크플로 서비스 인스턴스를 지속할 수 없고 무한 재귀 루프는 스택 오버플로로 이어집니다. <code>TransactedCancel</code> 및 <code>TransactedTerminate</code>만 메모리에 작업 항목을 만드므로 트랜잭션이 존재한다는 팩트는 아무 영향도 줄 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-109">But because there is an outstanding <code>WCF</code> request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because <code>TransactedCancel</code> and <code>TransactedTerminate</code> only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="8d5df-110">트랜잭션 롤백은 작업 항목을 삭제하지 않습니다. 이 문제를 해결하기 위해 .NET Framework 4.7.2부터 <code>TransactedCancel</code> 및 <code>TransactedTerminate</code>에 대한 트랜잭션을 무시하도록 지시하는 워크플로 서비스의 <code>web.config/app.config</code>에 추가될 수 있는 <code>AppSetting</code>을 도입했습니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-110">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an <code>AppSetting</code> that can be added to the <code>web.config/app.config</code> of the workflow service that tells it to ignore transactions for <code>TransactedCancel</code> and <code>TransactedTerminate</code>.</span></span> <span data-ttu-id="8d5df-111">이렇게 하면 트랜잭션이 워크플로 인스턴스가 유지되기를 기다리지 않고 커밋할 수 있습니다. 이 기능에 대한 AppSetting은 <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>이라고 합니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-111">This allows the transaction to commit without waiting for the workflow instance to persist.The AppSetting for this feature is named <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>.</span></span> <span data-ttu-id="8d5df-112"><code>true</code> 값은 트랜잭션을 무시하고 따라서 스택 오버플로를 방지해야 한다는 것을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-112">A value of <code>true</code> indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="8d5df-113">이 AppSetting의 기본값은 <code>false</code>이므로 기존 워크플로 서비스 인스턴스는 영향을 받지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-113">The default value of this AppSetting is <code>false</code>, so existing workflow service instances are not affected.</span></span>|
|<span data-ttu-id="8d5df-114">제안 해결 방법</span><span class="sxs-lookup"><span data-stu-id="8d5df-114">Suggestion</span></span>|<span data-ttu-id="8d5df-115">AppFabric 또는 다른 <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> 클라이언트를 사용하고, 워크플로 인스턴스를 취소하거나 종료하려고 할 때 워크플로 서비스 인스턴스에서 스택 오버플로가 발생하는 경우 워크플로 서비스에 대한 web.config/app.config 파일의 <code>&lt;appSettings&gt;</code> 섹션에 다음을 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-115">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow serivce instance when trying to cancel or terminate a workflow instance, you can add the following to the <code>&lt;appSettings&gt;</code> section of the web.config/app.config file for the workflow service:</span></span><pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre><span data-ttu-id="8d5df-116">문제가 발생하지 않는 경우 이 작업을 수행할 필요가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="8d5df-116">If you are not encountering the problem, you do not need to do this.</span></span>|
|<span data-ttu-id="8d5df-117">범위</span><span class="sxs-lookup"><span data-stu-id="8d5df-117">Scope</span></span>|<span data-ttu-id="8d5df-118">Microsoft Edge</span><span class="sxs-lookup"><span data-stu-id="8d5df-118">Edge</span></span>|
|<span data-ttu-id="8d5df-119">버전</span><span class="sxs-lookup"><span data-stu-id="8d5df-119">Version</span></span>|<span data-ttu-id="8d5df-120">4.7.2</span><span class="sxs-lookup"><span data-stu-id="8d5df-120">4.7.2</span></span>|
|<span data-ttu-id="8d5df-121">형식</span><span class="sxs-lookup"><span data-stu-id="8d5df-121">Type</span></span>|<span data-ttu-id="8d5df-122">대상 변경</span><span class="sxs-lookup"><span data-stu-id="8d5df-122">Retargeting</span></span>|

